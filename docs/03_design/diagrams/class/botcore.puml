@startuml BotCore-Classes
' =============================================================
' Bot Core Domain Class Diagram
' USDM: #US-001 #US-002 #US-003 #US-004
' =============================================================

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml
' ↑ 便宜上 C4 stereotypes を再利用（Entity / ValueObject / Service 等）

'---------------------------
' Value Objects
'---------------------------
class MiningArea <<ValueObject>> {
  +Coord start
  +Coord end
  +int volume()
}

class Coord <<ValueObject>> {
  +int x
  +int y
  +int z
}

'---------------------------
' Entities
'---------------------------
class Bot <<Entity>> {
  +UUID id
  +BotState state
  +Coord position
  +Inventory inventory
  +startMining(MiningArea)
  +stopMining()
}

class Tool <<Entity>> {
  +string name
  +int durability
  +int maxDurability
  +boolean isBroken()
}

enum BotState {
  Idle
  Moving
  Mining
  ToolSwap
  Error
}

class Inventory {
  +List<Tool> tools
  +addTool(Tool)
  +Tool nextUsableTool()
}

'---------------------------
' Domain Services
'---------------------------
class MiningEngine <<Service>> {
  +startMining(Bot, MiningArea)      #US-001-4
  +tick()                            ' per game tick
  -mineBlock()
}

class PathFinder <<Service>> {
  +List<Coord> calcPath(Coord from, Coord to)   #US-001-3
}

class ToolManager <<Service>> {
  +onDurabilityChange(Bot, Tool)     #US-003
  -equipTool(Bot, Tool)
}

class ProgressReporter <<Service>> {
  +updateProgress(Bot, int minedBlocks)
}

class ChatReporter <<Service>> {
  +reportProgress(BotStatus)         #US-004
}

'---------------------------
' Associations
'---------------------------
Bot "1" -- "1" Inventory
Inventory "1" *-- "0..*" Tool
Bot "1" --> MiningEngine : uses
MiningEngine ..> PathFinder
MiningEngine ..> ToolManager
MiningEngine ..> ProgressReporter
ProgressReporter ..> ChatReporter
ToolManager ..> Inventory : swap tools
MiningEngine --> MiningArea : target

@enduml