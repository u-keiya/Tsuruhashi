@startuml BotCore-Classes-Revised
' =============================================================
' Bot Core Domain Class Diagram (Plugin Architecture)
' USDM: #US-001 #US-002 #US-003 #US-004
' =============================================================

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

'---------------------------
' Core API & Infrastructure
'---------------------------
class Bot <<Entity>> {
  +UUID id
  +EventEmitter events
  +State state
  +Protocol protocol
  +PluginLoader plugins
  --
  +chat(message)
  +dig(block)
  +equip(item)
  +...
}

class Protocol <<Service>> {
  +connect()
  +send(packet)
  +onPacket()
}

class PluginLoader <<Service>> {
  +load(name, options)
  +unload(name)
  +get(name)
}

abstract class Plugin {
  +Bot bot
  +inject()
}

'---------------------------
' Core Plugins
'---------------------------
class PhysicsPlugin extends Plugin {
  +Vector3 position
  +Vector3 velocity
  +simulate()
}

class WorldPlugin extends Plugin {
  +Block getBlock(coord)
  +Entity getEntity(id)
}

class InventoryPlugin extends Plugin {
  +List<Item> items
  +int emptySlotCount()
}

'---------------------------
' Behavior Plugins
'---------------------------
class AutoMiningPlugin extends Plugin {
  +start(area)
  +stop()
  -onTick()
}

class ReporterPlugin extends Plugin {
  +start()
  +stop()
  -report()
}

'---------------------------
' Enumerations / Value Objects
'---------------------------
enum State {
  Idle
  Moving
  Mining
  ToolSwap
  Error
}

class Vector3 <<ValueObject>> {
  +float x
  +float y
  +float z
}

class Block <<ValueObject>> {
  +Coord pos
  +string type
}

class Item <<ValueObject>> {
  +string name
  +int durability
  +int maxDurability
}

class Coord <<ValueObject>> {
  +int x
  +int y
  +int z
}

'---------------------------
' Associations
'---------------------------
Bot "1" o-- "1" Protocol
Bot "1" o-- "1" PluginLoader
PluginLoader "1" *-- "0..*" Plugin
Plugin "1" -- "1" Bot

AutoMiningPlugin ..> WorldPlugin : uses
AutoMiningPlugin ..> PhysicsPlugin : uses
AutoMiningPlugin ..> InventoryPlugin : uses

'---------------------------
' Deletion
'---------------------------
class DeletionManager <<Service>> {
  +deleteBot(botId)
}

class BotDeleted <<Event>> {
  +UUID botId
  +Timestamp deletedAt
}

Bot "1" o-- "1" DeletionManager
DeletionManager --> BotDeleted : publish

@enduml