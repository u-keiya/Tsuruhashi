# 2025-08-15 22:45 DSセッション記録

## Summary
本セッションでは、現行設計を Mineflayer 型プラグインアーキテクチャへ段階的に移行する方針を検討し、ADR-0003 の新設・適用を決定しました。Bot Core の機能を「Core API + PluginLoader」を中核とするプラグイン境界へ再構成し、Behavior Plugin（例：AutoMining）と Core Plugin（Physics/World 等）を分離して拡張性を高める方向性を採用します。さらに、OpenAPI と図の更新を進め、 MVP は Core API + PluginLoader + Physics/World の最小構成から開始します。最終的な目標は、Mineflayer のプラグインエコシステムに近い疎結合・拡張性を実現することです。

## User Requirement
- USDM: US-001, US-002, US-003, US-004 の最小実装を現行設計で達成可能であることを確認
- 将来的な拡張性・保守性を確保するプラグインベースアーキテクチャの採用
- ツール交換（US-004）以降の行動ロジック拡張をプラグイン化で対応
- 非機能要件としての堅牢性向上（プラグイン単位でのテスト・配布を前提）

## Key Decisions
- プラグインアーキテクチャの採用を方針として確定（ADR-0003 の新設を提案・承認待ち）
- Bot Core を「Core API + PluginLoader」を中心に再構成
- 行動ロジックは Behavior Plugin（例：AutoMiningPlugin）として実装、Core とは疎結合化
- 物理演算・ワールド状態は Core Plugin として提供、他の Behavior Plugin から再利用可能
- Control API に /bots/{botId}/plugins/load および /unload のエンドポイントを追加
- MVP の状態永続先は SQLite（Bot インスタンスごとの状態保存）を採用
- 署名/Sandbox 機構は MVP には含めず、将来の拡張で別途検討

## Action Items
- [ ] ADR-0003-plugin-architecture.md を docs/03_design/adr/ に作成（SA）
- [ ] C4 コンポーネント図・クラス図を「プラグイン境界」反映へ更新（SA/DD）
- [ ] Sequence 図（auto_mining_cycle 等）をプラグイン呼び出しの流れに合わせて改訂（DD）
- [ ] openapi.yaml に PluginSpec のスキーマ追加と /bots/{botId}/plugins/load|unload のエンドポイント追加を整合させる（DD）
- [ ] PoC: Core API + Physics プラグインの実装準備（Dev）
- [ ] MVP の状態永続用 SQLite スナップショット設計の議論と実装計画（Dev）

## References
- Plugin仕様・設計参照
  - PluginSpec schema の定義参照: [`docs/03_design/api/openapi.yaml`](docs/03_design/api/openapi.yaml:1)
  - ADR 0003 のドラフト/方針: [`docs/03_design/adr/0003-plugin-architecture.md`](docs/03_design/adr/0003-plugin-architecture.md:1)
- USDM/ADR関連
  - [USDM] US-001, US-002, US-003, US-004
  - ADR-0003
- 影響範囲の図・API仕様
  - OpenAPI のエンドポイント追加後の影響を確認するための base 資料: [`docs/03_design/api/openapi.yaml`](docs/03_design/api/openapi.yaml:1)
  - BotCore クラス図・シーケンス図の更新案: [`docs/03_design/diagrams/class/botcore.puml`](docs/03_design/diagrams/class/botcore.puml:1)
  - 自動採掘シーケンス案: [`docs/03_design/diagrams/sequence/auto_mining_cycle.puml`](docs/03_design/diagrams/sequence/auto_mining_cycle.puml:1)
